#pragma once

#include "utility.h"
#include "board.h"

struct Evaluation : Noncopyable
{
	int mg_bonus[2];
	int eg_bonus[2];
	uint64_t ring[2];
	uint64_t zone[2];
	int ring_pressure[2];
	int zone_pressure[2];
	int ring_attackers[2];
	int zone_attackers[2];

	uint64_t attacked_by_pawn[2];

	int mg_piece_value[6] = { 50, 301, 319, 407, 919, 0, };
	int eg_piece_value[6] = { 76, 324, 337, 593, 1109, 0, };
	
	int mg_pawn_psqt[64] = {
		0, 0, 0, 0, 0, 0, 0, 0,
		42, 47, 32, 56, 34, 30, -11, -25,
		10, 4, 23, 29, 34, 70, 60, 22,
		-6, 0, 10, 12, 32, 36, 13, 17,
		-8, -7, 10, 21, 24, 27, 11, 5,
		-15, -8, 1, 7, 16, 8, 11, 3,
		-7, -3, 4, -1, 10, 24, 24, -5,
		0, 0, 0, 0, 0, 0, 0, 0,
	};
	int mg_knight_psqt[64] = {
		-94, -56, -41, -15, -1, -42, -46, -62,
		-32, -22, 0, 9, -16, 31, -22, -6,
		-27, -6, 3, -1, 29, 34, 8, -13,
		-13, -3, 8, 29, 18, 37, 9, 20,
		1, 5, 10, 17, 21, 19, 24, 11,
		-18, -9, -7, -7, 10, -5, 9, -4,
		-20, -14, -11, 3, 0, 4, 3, 1,
		-45, -11, -27, -15, -6, -2, -9, -22,
	};
	int mg_bishop_psqt[64] = {
		-22, -46, -45, -72, -62, -73, -27, -45,
		-17, -4, -17, -25, -6, -18, -30, -44,
		-9, 6, 5, 6, -1, 27, 5, -4,
		-18, 1, 0, 17, 6, 0, 1, -25,
		-3, -18, -9, 11, 5, -8, -14, 9,
		-4, 6, -1, 0, 3, 2, 4, 14,
		16, 3, 12, -7, 0, 13, 26, 14,
		4, 12, -1, -13, -1, -5, 14, 29,
	};
	int mg_rook_psqt[64] = {
		12, 5, 3, -5, 15, 24, 31, 47,
		-3, -6, 9, 25, 9, 29, 32, 53,
		-12, 14, 7, 6, 31, 29, 68, 37,
		-19, -4, -7, -5, -4, 3, 9, 8,
		-30, -31, -25, -20, -19, -31, -7, -19,
		-29, -24, -19, -20, -9, -10, 15, -5,
		-27, -21, -11, -10, -5, -1, 15, -19,
		-12, -13, -13, -6, 1, -1, 0, -6,
	};
	int mg_queen_psqt[64] = {
		-23, -19, -11, 8, -1, 12, 33, 6,
		1, -28, -27, -40, -39, -11, -6, 42,
		4, -6, -5, -13, -3, 20, 25, 19,
		-10, -4, -15, -22, -18, -15, -2, -4,
		0, -15, -13, -9, -15, -17, -3, 2,
		-3, 3, -6, -9, -4, -2, 10, 8,
		3, 3, 11, 11, 11, 14, 21, 19,
		2, -7, -2, 10, 5, -3, 2, 6,
	};
	int mg_king_psqt[64] = {
		-33, -2, 5, -24, -3, 9, 14, 3,
		-38, 13, 1, 44, 26, 33, 40, 8,
		-50, 39, 3, -5, 19, 63, 39, -8,
		-37, -16, -19, -59, -55, -24, -35, -87,
		-50, -20, -34, -73, -65, -34, -54, -115,
		-30, 19, -21, -40, -26, -35, -9, -63,
		27, 11, 10, -14, -19, -6, 20, 6,
		15, 32, 22, -49, 8, -36, 19, 28,
	};
	int eg_pawn_psqt[64] = {
		0, 0, 0, 0, 0, 0, 0, 0,
		115, 106, 110, 85, 87, 93, 110, 119,
		55, 58, 52, 60, 53, 47, 71, 61,
		35, 27, 24, 14, 15, 16, 21, 17,
		21, 21, 17, 15, 13, 12, 11, 8,
		17, 13, 17, 23, 21, 17, 5, 4,
		20, 19, 23, 30, 34, 22, 7, 6,
		0, 0, 0, 0, 0, 0, 0, 0,
	};
	int eg_knight_psqt[64] = {
		-45, -23, -3, -10, -2, -27, -17, -49,
		-1, 2, -1, 1, -3, -15, -1, -12,
		-2, -2, 9, 11, 2, -8, -10, -7,
		6, 4, 12, 14, 13, 10, 9, -2,
		12, 7, 23, 24, 27, 16, 9, 11,
		-4, 1, 8, 19, 18, 2, 0, 3,
		0, 3, 0, 1, -1, -3, -3, 15,
		4, -6, -5, -3, 0, -6, 2, 5,
	};
	int eg_bishop_psqt[64] = {
		2, 4, 0, 5, 1, -4, -2, -12,
		-8, -4, -1, -1, -9, -5, 1, -3,
		9, -1, 4, -4, -1, 5, 0, 9,
		4, 8, 5, 17, 10, 9, 3, 6,
		0, 10, 14, 13, 12, 8, 7, -10,
		1, 6, 9, 13, 16, 8, 0, -1,
		8, -6, -7, 2, 5, -3, 0, -5,
		-6, 6, -1, -1, -4, 10, -7, -21,
	};
	int eg_rook_psqt[64] = {
		16, 19, 26, 22, 17, 16, 16, 12,
		14, 23, 25, 17, 18, 14, 11, 3,
		14, 14, 15, 13, 6, 2, 1, -3,
		17, 13, 19, 15, 6, 2, 6, 0,
		11, 13, 12, 10, 8, 9, 3, 1,
		4, 2, -1, 1, -3, -7, -17, -15,
		-3, -1, -2, -4, -10, -13, -22, -14,
		2, -2, 3, -2, -8, -4, -9, -9,
	};
	int eg_queen_psqt[64] = {
		-2, 7, 27, 26, 26, 23, 2, 11,
		-13, 8, 31, 50, 61, 37, 26, 30,
		-6, 3, 26, 40, 48, 41, 19, 28,
		4, 9, 19, 38, 47, 44, 45, 35,
		-5, 12, 14, 26, 34, 31, 28, 24,
		-19, -7, 5, 9, 14, 10, -1, -2,
		-20, -25, -27, -16, -13, -34, -46, -42,
		-26, -23, -23, -26, -25, -31, -30, -32,
	};
	int eg_king_psqt[64] = {
		-98, -39, -26, -4, -12, -4, 1, -85,
		-20, 19, 24, 26, 37, 45, 42, 4,
		-9, 27, 39, 45, 50, 50, 47, 4,
		-19, 23, 37, 47, 47, 43, 36, -3,
		-28, 11, 28, 42, 41, 28, 18, -12,
		-34, 0, 16, 27, 26, 18, 4, -19,
		-38, -5, 4, 12, 16, 9, -5, -30,
		-96, -48, -33, -21, -34, -21, -42, -102,
	};
	
	int ring_attack_potency[6] = { 0, 36, 65, 35, 110, 0, };
	int zone_attack_potency[6] = { 0, -8, 4, 85, 55, 0, };
	
	int ring_pressure_weight[8] = { 0, 12, 26, 40, 54, 51, 19, 0, };
	int zone_pressure_weight[8] = { 0, -5, 0, 5, 9, 10, 11, 5, };
	int mg_pawn_shield[6] = { 0, 33, 39, 27, 30, 12, };
	
	int mg_knight_mobility[9] = { -110, -46, -25, -15, -4, -1, 9, 19, 31, };
	int eg_knight_mobility[9] = { -82, -51, -21, -2, 8, 17, 20, 22, 20, };
	
	int mg_bishop_mobility[14] = { -57, -57, -26, -18, -6, 1, 7, 13, 16, 21, 24, 37, 37, 48, };
	int eg_bishop_mobility[14] = { -93, -72, -32, -11, -2, 4, 12, 16, 21, 21, 23, 17, 19, 9, };
	
	int mg_rook_mobility[15] = { -16, -52, -23, -16, -10, -10, -7, -12, -8, -4, 1, 2, 6, 17, 20, };
	int eg_rook_mobility[15] = { -24, -59, -40, -23, -17, -1, 5, 12, 11, 15, 17, 21, 25, 23, 23, };
	
	int mg_queen_mobility[28] = { 0, 0, -15, -66, -58, -23, -12, -9, -7, -6, -3, 0, 2, 5, 5, 5, 4, 1, 1, 0, 6, 15, 31, 37, 38, 60, 32, 19, };
	int eg_queen_mobility[28] = { 0, 0, -6, -61, -65, -63, -66, -52, -36, -14, -7, -1, 7, 9, 13, 22, 25, 34, 39, 43, 48, 41, 41, 39, 46, 48, 37, 28, };
	
	int mg_king_mobility[9] = { 0, 13, -8, 13, -7, 21, -41, -22, -4, };
	int eg_king_mobility[9] = { 7, 117, 56, 24, 20, -10, 4, -3, -20, };
	
	int mg_isolated_penalty = -15;
	int eg_isolated_penalty = -13;
	
	int mg_doubled_penalty = -6;
	int eg_doubled_penalty = -13;
	
	int mg_backward_penalty = -12;
	int eg_backward_penalty = -15;
	
	int mg_chained_bonus = 9;
	int eg_chained_bonus = 9;
	
	int mg_passed_bonus[64] = {
		0, 0, 0, 0, 0, 0, 0, 0,
		42, 47, 32, 56, 34, 30, -11, -25,
		37, 45, 33, 23, 17, 15, -16, -41,
		32, 22, 24, 20, 7, 8, -3, -3,
		9, 2, -20, -8, -17, -13, -9, 0,
		7, -10, -21, -17, -14, -10, -8, 20,
		1, -2, -13, -8, 9, 0, 14, 14,
		0, 0, 0, 0, 0, 0, 0, 0,
	};
	int eg_passed_bonus[64] = {
		0, 0, 0, 0, 0, 0, 0, 0,
		115, 106, 110, 85, 87, 93, 110, 119,
		135, 132, 98, 61, 67, 87, 98, 123,
		84, 82, 57, 48, 45, 56, 78, 83,
		52, 48, 36, 26, 29, 37, 55, 50,
		18, 26, 19, 9, 10, 16, 38, 19,
		17, 21, 19, 2, -4, 8, 20, 18,
		0, 0, 0, 0, 0, 0, 0, 0,
	};
	
	int mg_double_bishop = 19;
	int eg_double_bishop = 65;
	
	int mg_rook_open_file = 30;
	int eg_rook_open_file = 10;
	
	int mg_rook_half_open_file = 8;
	int eg_rook_half_open_file = 14;
	
	int mg_knight_outpost = 30;
	int eg_knight_outpost = -3;
	
	int mg_knight_outpost_supported = 42;
	int eg_knight_outpost_supported = 25;

	int tempo_bonus = 19;

	int taper_start = 6377;
	int taper_end = 321;

	void evaluate_pawns(  Board &board, Color friendly);
	void evaluate_knights(Board &board, Color friendly);
	void evaluate_bishops(Board &board, Color friendly);
	void evaluate_rooks(  Board &board, Color friendly);
	void evaluate_queens( Board &board, Color friendly);
	void evaluate_kings(  Board &board, Color friendly);

	void note_king_attacks(Piece_type type, uint64_t attacks, Color friendly);

	void evaluate_mobility(Board &board, Piece_type type, uint64_t attacks, Color friendly);

	int evaluate(Board &board);
};
