// checks, if the evaluations are computed correctly

std::string test_positions[200] = {
	"rnb1kbnr/pp1pppp1/7p/2q5/5P2/N1P1P3/P2P2PP/R1BQKBNR w KQkq ",
	"r1q1kb1r/6pp/b1p1pn2/2P1Np2/QP6/4P3/P2N2PP/R1BR2K1 b kq ",
	"8/8/1p1k4/1P6/8/3p3P/1r4P1/5K2 w - - ",
	"r6r/n6p/6p1/1p3pb1/q7/P1B1kP1P/6P1/6K1 b - - ",
	"8/6P1/8/1pk1r3/6RP/8/3K4/8 b - - ",
	"8/1R6/1p6/3pkp2/P6p/1P1K3P/4r1P1/8 b - - ",
	"4r3/pp3R2/6pk/3p3p/3P4/1P5P/P2b1PN1/5K2 b - - ",
	"4r1k1/p1q2p1p/1p2p1p1/4P3/2b1P3/2B3P1/5P1P/3R2K1 b - - ",
	"rn2kb1r/ppp1pp1p/2q3p1/3nN3/3P4/2N1P3/PPb2PPP/R1B1KB1R b KQkq - ",
	"r4rk1/1p2ppbp/pP4p1/q7/1n2P3/1Q6/PP1BNPPP/R4RK1 b - - ",
	"4r3/pq3pk1/1p2p1pp/1P2P3/P3P3/4BPP1/7P/3Q2K1 w - - ",
	"2q1r1k1/p4p1p/1p2p1p1/1b2P3/4P3/1P4P1/P2B1P1P/1Q1R2K1 w - - ",
	"8/5k2/8/2p1r1nR/8/8/5K2/8 w - - ",
	"2b1kr2/4p3/2p5/8/2P1Pn2/R4BK1/6P1/7R w - - ",
	"r1b1k1r1/p2npp1p/2pp1n1R/qp6/3PP3/5N2/PPPN1PP1/R2QKB2 b Qq - ",
	"2r5/4p1k1/R1p5/3nP3/8/8/1N2K1P1/8 w - - ",
	"5r2/4p1k1/2p3n1/4p3/rpP1P3/1N6/P1N1b1P1/R5KR w - - ",
	"7k/p7/1p2Q2p/8/8/q5K1/5P1P/8 w - - ",
	"2k5/7Q/1p6/8/7K/8/8/8 w - - ",
	"Q7/8/1p6/8/8/7K/1k6/8 b - - ",
	"5k2/p4p2/1p6/7p/3Q4/P4P2/1P4KP/2q5 b - - ",
	"r1br2k1/pp3p2/4p2p/3nQ1p1/8/P1NR3N/1q3PPP/2R3K1 w - - ",
	"8/8/4kp1p/3b4/2p2K2/4P2P/2r2PP1/8 w - - ",
	"r5k1/6pp/2b5/4R3/2N5/b1B5/5PPP/6K1 b - - ",
	"5rk1/4b1pp/Q4p2/2pqn3/8/1RB1P3/P4PPP/R5K1 w - - ",
	"r7/5kp1/5p1p/1b6/2p1KP2/4P2P/1B4P1/2R5 b - - ",
	"7r/R7/3pk3/3b1p2/1p4p1/8/1P4PP/3R2K1 b - - ",
	"8/3k4/4r3/2Rp4/1P2bR1P/5p1K/8/8 w - - ",
	"1kr5/8/3p4/3b1p2/1p4p1/1P6/5KPP/8 w - - ",
	"5R2/8/7r/1p1p4/1P1kb2P/5pK1/8/4R3 b - - ",
	"r3kbnr/pq2p1p1/8/4B2p/8/6P1/P3PP1P/R2Q1RK1 b kq - ",
	"5b2/pp1b1kp1/2r5/4Q3/8/6P1/1B2P2P/6K1 w - - ",
	"8/6p1/1R6/1p2k3/2b3P1/8/4P1KP/8 w - - ",
	"r3kb1r/pp2ppp1/4b3/3qN2p/5Q2/6P1/PB2PP1P/R4RK1 b kq - ",
	"r3kb1r/pp1n1pp1/q1p1pnp1/3p4/3P2P1/7P/PPPBPPB1/RN1Q1RK1 w kq - ",
	"rn1qkb1r/pp2pppp/5n2/3p4/3P2b1/5NP1/PP2PPBP/RNBQ1RK1 w kq - ",
	"8/1R4p1/5k2/8/6P1/7P/4b3/6K1 w - - ",
	"1R6/7k/6pp/4Pp2/3q4/r5PP/4Q2K/8 w - - ",
	"6k1/1r4pp/p1q5/2pb4/4p3/P1BPP1P1/6BP/4Q2K w - - ",
	"4R3/7k/6pp/4Pp2/3q4/7P/3r2PK/5Q2 w - - ",
	"8/6pp/p3b3/4k3/8/6P1/4K2P/1r6 w - - ",
	"6k1/6pp/p2r4/4P3/6P1/8/5K1P/8 b - - ",
	"8/6k1/3rp1pp/5p2/5q2/Q6P/2R3P1/7K w - - ",
	"6k1/7p/p7/2p1P1p1/4b3/5pP1/r2B1K1P/3R4 w - - ",
	"7k/7p/p1bq4/2R5/4P1r1/P5P1/3P3P/7K w - - ",
	"2N4R/2k2pp1/B3p3/5b2/P7/1p4P1/1r2PP2/5K2 b - - ",
	"r1bqkbnr/3pp1pp/p1n2p2/7P/Pp2P2Q/5N2/1PP2PP1/RNB1KB1R b KQkq - ",
	"3rk2r/4bppp/p1pp3n/8/Pp3B2/4R3/1Pb1PPP1/R3KB2 w Q - ",
	"7r/1B3p1p/p3pk1p/8/P5b1/8/1PN1PP2/5K2 b - - ",
	"1R6/8/5k2/8/4n1K1/2P3p1/8/8 w - - ",
	"b7/8/6k1/4K3/2p5/6p1/1P6/8 w - - ",
	"8/1R6/4b3/2p1k3/8/4n1K1/1P6/8 b - - ",
	"rnbqkb1r/1pp1ppp1/5n1p/p2p4/3P3P/2N1PN2/PPP2PP1/R1BQKB1R b Qkq - ",
	"3r2k1/3b1ppp/2B5/2BP4/P7/6P1/1r3P1P/2R3K1 w - - ",
	"r3r1k1/1p3ppp/p4n2/3p4/Pn1P4/RPN3PN/1B5P/5RK1 w - - ",
	"r5k1/1bB2pp1/8/1B4P1/P1RP4/7r/5P2/6K1 b - - ",
	"r1bqkbnr/pp2pppp/2n5/1Np5/P2p4/1P4PP/2PPPPB1/R1BQK1NR b KQkq - ",
	"r1bqkb1r/pp2pppp/2n2n2/2pp4/P7/4PNP1/1PPP1PBP/RNBQK2R w KQkq - ",
	"r1bqkbnr/pp3ppp/2n5/2pp4/P7/BP4P1/2PP1PBP/RN1QK1NR w KQkq - ",
	"r5k1/5pp1/7p/8/PBbr3P/6P1/2R2P2/6K1 w - - ",
	"8/5P1R/8/8/3K2p1/8/5rk1/8 b - - ",
	"8/5k2/6p1/pp3p2/P4PpP/1P4P1/R4PK1/8 b - - ",
	"2r3k1/1p1qppb1/6p1/Q2P3p/1N2nB2/5PP1/PP3P1P/5RK1 b - - ",
	"r4rk1/1p1q2b1/2n1p1p1/pQ3p1p/3PnB2/P4NP1/1PN1PP1P/R4RK1 w - - ",
	"r4rk1/1p2pp2/2q3p1/p5np/5B2/6P1/PQN1PP1P/R4RK1 b - - ",
	"6k1/1p6/6p1/p4p2/6pP/1P4P1/P3NP2/3R1K2 b - - ",
	"8/8/5k2/5p2/5RpP/8/5P2/4K3 w - - ",
	"8/2k5/2b5/P1N1P1p1/3P1pP1/8/5P2/6K1 w - - ",
	"b7/3Bk3/2p5/2N1P1p1/P2P2P1/5p1K/5P2/8 b - - ",
	"8/1q4k1/2p1p3/Q2nPp2/3P2p1/6P1/1P3P2/5BK1 w - - ",
	"2r3k1/5p2/q1p3pp/1p1p4/1b1P4/2NP2PP/2Q2PK1/2R5 w - - ",
	"8/8/8/3P1N2/5b2/3P3K/5k2/8 w - - ",
	"1r4k1/2q2pp1/1pp4p/p2pR3/N2P4/bP1P2PP/2Q2PK1/8 b - - ",
	"8/3q4/2pb1pk1/1p1p3p/1P1P3P/Q2P1pP1/5P1K/8 b - - ",
	"r5k1/1pq2pp1/2pb1n2/p2p4/N2P4/PP1P1Q1P/5PP1/2B1R1K1 w - - ",
	"r5k1/1N3pp1/1ppb3p/3p4/1p1P4/P2P2PP/4QP2/R5K1 b - - ",
	"8/8/8/3p4/1P1P2k1/2NP4/7p/2b4K b - - ",
	"2r3k1/2b2pp1/1pp4p/3p4/1P1P4/2NQ2PP/5PK1/1R6 b - - ",
	"4r1k1/1rpb1pp1/1p5p/3P4/p1PBn1P1/3n3P/R1N2P1K/1R6 w - - ",
	"8/2R5/5n2/8/3k1K1P/8/8/8 b - - ",
	"3r4/1r3ppk/5n1p/1bB5/p3p1P1/R3N2P/5PB1/1R4K1 b - - ",
	"2R5/5pk1/p5p1/4K2p/1P3P1P/3r4/8/8 b - - ",
	"8/R7/5kp1/2r2p1p/7P/4PK2/8/8 w - - ",
	"8/5p2/p3p1pp/5k2/5P1P/4P1K1/8/1r6 b - - ",
	"8/5p2/4p1p1/1r5p/R4P1P/3k4/6K1/8 w - - ",
	"7r/p4pkp/4p1p1/4P1q1/8/2Q1PP2/PP5P/2R4K w - - ",
	"7r/pkp1b3/1p3p2/4pb2/2BB4/P1K2PPp/1PP4P/6NR w - - ",
	"1kb5/1p6/p6r/2p5/5N2/P3n1Pp/1P5P/4K3 w - - ",
	"r1bqkbn1/ppp2pp1/2n5/3pP2r/7P/8/PPP1PPP1/RNBQKB1R w KQq - ",
	"2kr3r/ppp1b1p1/2n1bn2/4p1N1/8/P6p/1PPBNPPP/R3KB1R b - - ",
	"r1bqk1nr/pppp1pp1/n7/4P3/1P6/8/PP2PPPp/RNBQKB1R w KQkq - ",
	"1r6/8/K4k2/2r4P/3NB3/6P1/8/4R3 w - - ",
	"8/4KB2/8/2r3kP/1p6/4N1P1/3r4/5R2 b - - ",
	"1rB5/8/8/1p1NR2P/7k/4K3/6r1/8 w - - ",
	"6k1/7R/6P1/8/8/r3N3/5K2/8 b - - ",
	"8/8/8/1B6/4k3/N7/1K6/6r1 b - - ",
	"8/4B3/4k1Pb/8/2p5/8/2K5/8 w - - ",
	"8/4k1P1/7b/3p4/2pB4/K7/8/8 b - - ",
	"8/8/3Q1bk1/3P4/2p3P1/4B3/5P2/6K1 b - - ",
	"3r1r2/p2p2pk/bppR2p1/P3Pp2/2PQ3N/7P/5PP1/3R2K1 b - - ",
	"3r3r/pb2q2k/1ppRppp1/P4Q2/2P5/7P/5PP1/3R2K1 w - - ",
	"3q2bk/4p2p/3p2p1/2pP4/6P1/7P/3Q4/b3R1K1 b - - ",
	"8/8/5p2/2R3p1/4k3/7P/6P1/6K1 b - - ",
	"r1b1r2k/p2pnNpB/1pp5/4q3/8/1R5P/P1PQ1PP1/R5K1 b - - ",
	"r1b1r1k1/p2p1pp1/2p5/2pnP1N1/8/q6P/P2Q1PP1/R1R3K1 w - - ",
	"8/8/7p/2k3pP/6P1/7R/8/6K1 b - - ",
	"8/8/5R2/4n1pP/6P1/6k1/r7/6K1 w - - ",
	"6k1/6p1/p3n2p/8/2r5/5P2/6PP/r1B2K2 w - - ",
	"r1bqkb1r/p3pppp/2p5/2ppPn2/8/3P1N2/PPP2PPP/RNBQK2R w KQkq - ",
	"5k2/8/3R3p/6pP/4K1P1/1r6/8/8 b - - ",
	"5k2/3R2p1/4n2p/8/7r/5P1P/5KP1/8 b - - ",
	"8/6p1/4n1kp/8/7K/5P1P/1R4P1/8 b - - ",
	"3k4/8/6r1/1R2B1p1/5p1p/5P1P/4K1P1/8 w - - ",
	"8/8/4r3/8/2K2k1p/5P1P/6P1/8 w - - ",
	"8/8/6k1/2r3p1/5p1p/5P1P/4R1PK/B7 w - - ",
	"1b6/6k1/1r6/6np/1B1P1p2/P6P/5PPN/6K1 w - - ",
	"8/8/5k2/B5p1/3K3p/5PpP/8/2r5 w - - ",
	"8/6R1/8/4k3/5p1p/5P1P/1K4P1/8 b - - ",
	"5k2/1p2Npp1/4p3/4P2p/pB6/N5PP/P4n1K/3r4 w - - ",
	"8/1N3kp1/4pp1n/4B2p/8/b6P/P4PP1/6K1 w - - ",
	"r1br2k1/1pp1bpp1/4p2n/1Pn4p/p1N1P3/P2B1N1P/1B3PP1/R2R2K1 w - - ",
	"8/3k1p2/4pnp1/8/pB3K2/5P1P/P5P1/8 b - - ",
	"rnbqkb1r/1p3pp1/4p2n/1Pp4p/p3P3/2Qp1N1P/P4PP1/RNB1KB1R b KQkq - ",
	"8/5p2/n3p3/1p1k3p/p4K2/P7/3B1PP1/8 w - - ",
	"r2qk1nr/pp1b1pb1/3Np3/2p1n1pp/2P5/P1NPP3/1P2KPPP/R1BQ1B1R b kq - ",
	"3r1k2/5p2/8/p3rn2/4N1p1/3BP1P1/4KP2/1R6 b - - ",
	"2r5/8/1k6/8/6p1/3n2P1/5PK1/8 w - - ",
	"3r4/p7/5p1n/1P3k2/8/4PNP1/5K2/7B w - - ",
	"3R4/p5k1/7n/8/4p3/4PpP1/4K3/8 w - - ",
	"8/8/4k3/4n3/1R6/6P1/5r2/7K b - - ",
	"R7/2k5/1b6/8/4K3/8/8/8 b - - ",
	"5bk1/2R1pp2/4b1p1/7p/2pNPP1P/8/5P1K/8 b - - ",
	"8/b7/3k4/4p2p/4R2P/5P2/4K3/8 w - - ",
	"8/1R6/2k1p3/8/3b2Kp/5P2/8/8 w - - ",
	"5b2/4p3/1R3pk1/3P1p1p/5K1P/8/5P2/8 w - - ",
	"6k1/1R1bp3/6p1/2bB1p1p/5BnP/6P1/4PPK1/8 b - - ",
	"R7/8/1k2p3/3p1p2/3P1N2/1K2P1P1/5P2/2r5 b - - ",
	"8/4R3/6P1/3pP3/8/1k3K2/2r5/8 w - - ",
	"3k4/1p6/2n4R/3N1p2/3P4/4P1P1/4KP2/r7 w - - ",
	"8/2R3P1/r3p3/3pP3/8/3kP3/6K1/8 b - - ",
	"rnbqk2r/ppp4p/3bpn2/1P3p2/2p2Np1/4P1P1/PB1P1P1P/RN1QKB1R b KQkq - ",
	"8/8/1k2p3/3pPp2/5P2/4P1P1/r7/5K2 w - - ",
	"8/4R3/4p3/1k1pNpn1/3P4/4P1P1/5PK1/r7 w - - ",
	"4r1k1/8/4pR2/6PK/8/1P6/8/4R3 b - - ",
	"8/6k1/6P1/Pr6/8/1P6/6K1/8 w - - ",
	"7r/p3r1k1/4p3/3nN1P1/5pK1/1P6/P1R2P2/2R5 b - - ",
	"4R3/p2r1p1k/1p5p/5q2/7K/2P4P/1P2Q3/8 w - - ",
	"6k1/6p1/1p1K4/8/8/2PQ3P/5q2/8 b - - ",
	"6k1/3K2p1/1p6/8/3Q4/2P4P/q7/8 b - - ",
	"8/5p2/5k2/3P3p/1PR1K3/4P3/7r/8 b - - ",
	"8/1r3pk1/p6p/1p1pP1p1/PPp5/2P1K1PP/5P2/5R2 w - - ",
	"8/5pk1/1R4p1/1P6/3PK2P/4P3/2p2r2/8 w - - ",
	"rnbqk2r/1pp2ppp/5n2/p2p4/3P1N2/2P5/P1P1BPPP/R1BQK2R w KQkq - ",
	"8/8/4k3/5p1R/1PpP1K2/2r1P3/8/8 b - - ",
	"8/3r1p2/6pk/1p1p4/1PpP3P/5K1P/5P2/7R w - - ",
	"8/pp1rbp1k/6pp/3pB3/PPpP2P1/2P1N1P1/5PK1/4R3 b - - ",
	"1K2k3/2P2p2/4p3/4P1Pr/3P4/1R4P1/8/8 b - - ",
	"3Q4/8/8/2r1p1K1/5p2/k7/8/8 b - - ",
	"1r6/8/8/8/5K2/8/4k3/7Q b - - ",
	"8/2r2p2/3Np3/2Pk3p/1P2b1pP/4P1P1/5K2/R7 b - - ",
	"r1b1kb1r/ppp1ppp1/2n2n2/3q3p/3P4/5N2/PPP1BPPP/RNBQ1RK1 w kq - ",
	"8/8/R3ppp1/2rk3p/1P2N3/6PP/5K2/8 b - - ",
	"8/8/4p3/2r5/4kp2/8/8/5K2 w - - ",
	"8/1p3p2/4pkp1/2R4p/P1P2K2/1r2P1PP/8/8 w - - ",
	"r3k3/1p2ppb1/1B4p1/1R5p/3Nb3/P1P3PP/1P3P1K/8 b - - ",
	"5b2/pr3kp1/5p1p/2p1p3/2P1P3/4BP2/R2R1KP1/8 b - - ",
	"5b2/3R1ppk/6bp/2p1p3/R1P1P3/4BP2/5KP1/8 w - - ",
	"8/3b2p1/5p1p/4pPk1/4P3/3K2P1/8/6R1 w - - ",
	"R7/1b4pk/8/5P2/5K2/8/8/8 w - - ",
	"8/p1r2ppk/3b3p/2p1p2P/b1P1P3/4B3/1R3PP1/6K1 w - - ",
	"8/1k2K3/8/p7/2P3Q1/8/P7/8 w - - ",
	"8/5p2/2N5/6P1/3k1K2/7p/bP3P2/8 b - - ",
	"6Q1/1k5K/8/3q4/8/8/8/8 b - - ",
	"8/5p2/2p1k1p1/p6p/7P/5K2/NP3P2/8 b - - ",
	"8/5p2/2p1b3/p3k1P1/7p/P1N5/1P3P2/4K3 b - - ",
	"rnb4r/1p1k1pp1/p7/3pq2p/8/4PQ1P/PP1N1P2/2KR1B1R b - - ",
	"8/6K1/1q6/pk6/4Q3/8/8/8 b - - ",
	"6R1/3bkn2/4p3/3pP3/3P1P2/rN6/3K4/8 w - - ",
	"8/8/4k3/4Np2/p6P/P5P1/3b1P2/5K2 w - - ",
	"6k1/1q5p/2rrp1p1/2Q2p2/p7/P4NPR/2R2PKP/8 w - - ",
	"8/8/8/4ppkP/pN1b4/P1r3P1/5PK1/3R4 w - - ",
	"r2qkb1r/pbp2ppp/2n1pn2/1p1pP3/5B1P/3P1N2/PPPN1PP1/R2QKB1R b KQkq - ",
	"1R1n1k2/6R1/4p3/3pP3/N2P1P2/8/r7/4K3 w - - ",
	"5k2/8/2N5/5p2/p6P/P5P1/2r2bK1/4R3 w - - ",
	"3Q4/8/2b1p1k1/3pP3/3P1K2/5P1R/7N/6rq w - - ",
	"8/8/5k2/4r3/8/8/2K5/8 b - - ",
	"rr5k/1b2b3/4p2B/Pp1pP3/3n1NP1/8/5P1N/RR3K2 w - - ",
	"3r4/1p4pk/4Nn1p/1r3p2/4bB1P/1B6/PPP5/1K2R3 b - - ",
	"8/8/6k1/1K5n/PP5P/8/2r5/4r3 b - - ",
	"rnbqkb1r/1pp2ppp/5n2/p7/3pP3/2N5/PPPN2PP/R1BQKB1R w KQkq - ",
	"8/4r2k/rB3n1p/5p2/7P/PP6/1P6/1K4R1 w - - ",
	"8/5K2/1Q6/6p1/8/3k4/8/8 b - - ",
	"3R4/4P1pk/8/4P2p/8/8/4K3/7r b - - ",
	"2bq1rk1/2r1bpp1/pp2p3/3pPnPp/Q2n1P2/2P4P/PP3RB1/RNB3K1 b - - ",
	"6k1/1rr2pp1/p3p3/2p1P1Pp/P1P2P2/1P2RK1P/8/R7 b - - ",
	"6k1/8/4p1P1/4P3/3K1P2/8/8/8 w - - ",
	"2bq1rk1/4bp2/ppr1p1p1/2p1PnPp/P4P2/NPQP3P/4N3/R1B2RK1 b - - ",
	"8/3q4/1Q4p1/6kp/8/6P1/2p2P2/6K1 w - - ",
	"1Q6/3P4/6p1/4p1kp/4q3/2p3P1/5P1K/8 b - - ",
	"7q/6k1/pr1p2pp/2pPp3/1rP5/2Q3P1/RP3P2/1R4K1 b - - "
};

bool test(Tuner &tuner)
{
	std::cerr << "checking evaluations...\n";
	// load the weights from the engine evaluation function
	for (unsigned w = 0; w < NUM_WEIGHTS; w++)
		tuner.weights[w] = tuner.load_weight(w);

	bool error = false;
	for (unsigned position = 0; position < 200; position++) {
		Sample &sample = tuner.training_set.at(position);
		tuner.board.set_fenpos(test_positions[position]);
		double correct_eval = tuner.eval.evaluate(tuner.board);
		if (tuner.board.side_to_move == BLACK) correct_eval *= -1;

		double tuner_eval = tuner.evaluate(sample);

		// is the evaluation correct?
		if (fabs(tuner_eval - correct_eval) > 5) {
			std::cerr << "error in position " << position << ", where correct " << correct_eval << " and tuner " << tuner_eval << "\n";
			error = true;
		}
	}
	tuner.approximate_gradients(0);
	double approximated[NUM_WEIGHTS];
	for (unsigned grad = 0; grad < NUM_WEIGHTS; grad++)
		approximated[grad] = tuner.gradients[grad];

	tuner.compute_gradients(0);
	for (unsigned grad = 0; grad < NUM_WEIGHTS; grad++) {
		if (fabs(approximated[grad] - tuner.gradients[grad]) > 0.000001) {
			std::cerr << "gradient error: approx " << approximated[grad] << " comp " << tuner.gradients[grad] << "\n";
			error = true;
		}
	}
	return !error;
}
